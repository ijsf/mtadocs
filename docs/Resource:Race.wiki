{{Resource page}}

The "race" gamemode organizes sprint or freeroam races for one or more players. It supports both maps from MTA:Race and maps in the MTA:SA DM map syntax that were created in the map editor.

==Ingame==
Playing race is quite straightforward. If there are checkpoints, drive from checkpoint to checkpoint and be the first to reach the finish line within the time. If there are no checkpoints, just drive around and have fun.

In races you may encounter three types of pickups which will have an effect on your vehicle:
*'''Repair pickups:''' this pickup looks like a wrench. If you drive over it, your vehicle will be restored to full health.
*'''Nitrous oxide pickups:''' a red NOS bottle. After you drive over one you can press the fire button (by default the left mouse button) to get a temporary speed boost.
*'''Vehicle change pickups:''' these display the name of a vehicle above them. As soon as you drive over a pickup your vehicle will be changed.

Lastly, if you get stuck during a race, you can enter the /kill command in the chatbox to kill yourself and respawn at the previous checkpoint.

==Converting MTA:Race maps==
Use the [http://files.mtasa.com/apps/1.0/raceconv.zip batch converter] to convert all your MTA:Race maps into MTA:SA maps in one go.

==Map syntax==
You can create race maps using the new MTA:SA [[/Resource:editor.md|map editor]]. The map syntax is given here for reference.

===.map file===
<syntaxhighlight lang="xml">
<map>
    <!-- One or more -->
    <spawnpoint posX="X" posY="Y" posZ="Z" rotation="Rotation in degrees" vehicle="Vehicle ID" id="spawnpointID" [ paintjob="paintjob ID" upgrades="comma-separated list of upgrades" ] />

    <!-- Zero or more --> 
    <checkpoint posX="X" posY="Y" posZ="Z" color="#FF0000" id="textual or numeric checkpoint ID" nextid="ID of checkpoint after this one" [ size="checkpoint size" vehicle="vehicle ID to change into" type="checkpoint/ring/cylinder/arrow/corona" paintjob="paintjob ID" upgrades="comma-separated list of upgrades" ] />

    <!-- Zero or more -->
    <object posX="X" posY="Y" posZ="Z" rotX="in degrees" rotY="in degrees" rotZ="in degrees" model="model ID" id="objectID" />

    <!-- Zero or more -->
    <pickup posX="X" posY="Y" posZ="Z" type="repair|nitro|vehiclechange" id="pickupID" [ vehicle="vehicle ID" paintjob="paintjob ID" upgrades="comma-separated list of upgrades" ] />
</map>
</syntaxhighlight>

===meta.xml===
<syntaxhighlight lang="xml">
<meta>
   <info type="map" gamemodes="race" name="Map name" author="Author name" description="Map description" version="Map version number"/>
   <race src="Map file.map"/>
   <settings>
      <setting name="#optionName" value="optionValue"/>
      ...
   </settings>
</meta>
</syntaxhighlight>
The <setting>s correspond to options in MTA:Race syntax. For example, <time>4:0</time> in MTA:Race syntax would correspond to <setting name="#time" value="4:0"/> in DM syntax.

==Addons==
A Race 'addon' is no different from any other script resource, except that is has addon="race" in the <info> section of it's meta.xml file. This is simply to allow Race to identify it and put it in the /config menu for you. Addons communicate with Race via events. The current list of Race events and what they do are here:

==Events for version 0.8.3==
'''Note:''' You may have to add the events in your script using addEvent() if you want to use them.
===Server===

{| class="wikitable" border="0"
|-
|width="200pt"|'''Name'''
|width="60pt"|'''Source'''
|'''Parameters'''	
|}

{| class="wikitable" border="0"
|-
|width="200pt"|'''onPlayerReachCheckpoint'''
|width="60pt"|player	
|<syntaxhighlight lang="lua">int checkpoint, int time_</syntaxhighlight>	
|}

{| class="wikitable" border="0"
|-
|width="200pt"|'''onPlayerPickUpRacePickup'''
|width="60pt"|player	
|<syntaxhighlight lang="lua">int/string pickupID, string pickupType, int vehicleModel</syntaxhighlight>
|}

{| class="wikitable" border="0"
|-		
|width="200pt"|'''onMapStarting'''
|width="60pt"|
|<syntaxhighlight lang="lua">table mapInfo, table mapOptions, table gameOptions</syntaxhighlight>	
|}

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onPlayerFinish'''
|width="60pt"|player	
|height="20pt"|<syntaxhighlight lang="lua">int rank, int time</syntaxhighlight>	
|}

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onPostFinish'''	
|width="60pt"|
|height="38pt"|	
|}

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onPollStarting'''
|width="60pt"|
|<syntaxhighlight lang="lua">table poll</syntaxhighlight>	
|}

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onRaceStateChanging'''
|width="60pt"|
|<syntaxhighlight lang="lua">string newStateName, string oldStateName</syntaxhighlight>	
|-	
|}

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onPlayerRaceWasted'''
|width="60pt"|player
|<syntaxhighlight lang="lua">vehicle playersVehicle</syntaxhighlight>	
|-	
|}

===Client===

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onClientMapStarting'''
|width="60pt"|
|<syntaxhighlight lang="lua">table mapinfo</syntaxhighlight>	
|-	
|}

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onClientPlayerFinish'''
|width="60pt"|player	
|height="38pt"|
|-	
|}

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onClientPlayerOutOfTime'''
|width="60pt"|player	
|height="38pt"|
|-	
|}

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onClientMapStopping'''
|width="60pt"|
|height="38pt"|
|-	
|}

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onClientScreenFadedOut'''
|width="60pt"|
|height="38pt"|
|-	
|}

{| class="wikitable" border="0"
|-	
|width="200pt"|'''onClientScreenFadedIn'''
|width="60pt"|
|height="38pt"|
|-	
|}

==Events for version 0.8.3 in detail==
'''Note:''' You may have to add the events in your script using addEvent() if you want to use them.
===onRaceStateChanging===
Triggered when the race resource starts doing something else.
===Parameters===
<syntaxhighlight lang="lua">string newState, string oldState</syntaxhighlight>
*'''newState:''' the new state
*'''oldState:''' the old state

Possible states:
* undefined     
* NoMap      
* LoadingMap    
* PreGridCountdown
* GridCountdown
* Running    
* MidMapVote
* SomeoneWon
* TimesUp
* EveryoneFinished
* PostFinish
* NextMapSelect
* NextMapVote
* ResourceStopping

===Source===
The root element.

===onPlayerReachCheckpoint===
Triggered when a player reaches any checkpoint but the last one.
====Parameters====
<syntaxhighlight lang="lua">int checkpoint, int time</syntaxhighlight>
*'''checkpoint:''' the number of the checkpoint the player went through. The first checkpoint has number 1.
*'''time:''' time since the race started, in milliseconds.

====Source====
The source is the player that reached the checkpoint.

===onPlayerFinish===
Triggered when a player reaches the last checkpoint (i.e. has finished the race)
====Parameters====
<syntaxhighlight lang="lua">int rank, int time</syntaxhighlight>
*'''rank:''' the player's rank. 1 means he won the race, 2 that he came in second place, etc.
*'''time:''' time since the race started, in milliseconds.

====Source====
The source is the player that finished the race.

===onPlayerPickUpRacePickup===
====Parameters====
<syntaxhighlight lang="lua">int/string pickupID, string pickupType, int vehicleModel</syntaxhighlight>
*'''pickupID:''' the number of the pickup in case of MTA:Race syntax (starting at 1), or the "id" attribute of the pickup in case of DM syntax.
*'''pickupType:''' the pickup type. Can be "nitro", "repair" or "vehiclechange".
*'''vehicleModel:''' if the pickup is of type vehiclechange, this is the vehicle model that it sets.

====Source====
The source is the player that picked up the pickup.

==Element data==
These element data are set on each player:
*'''race rank:''' the current position of the player in the race. 1 = first, 2 = second etc. Updated on a 1 second interval.
*'''race.checkpoint:''' the number of the checkpoint the player is ''heading for''. When the player spawns this number is 1, after he passed the first checkpoint it's 2, etc.
*'''race.finished:''' ''true'' if the player has finished, ''false'' if he's still racing.

This server only element data is set for the resource root element:
*'''info:''' which contains a table with these sub-tables: '''mapInfo''', '''mapOptions''' and '''gameOptions'''.

==Super Advanced Element data==
You can also set player element data to change the player collision status and render transparency:
<syntaxhighlight lang="lua">
e.g. setElementData( thePlayer, "overrideCollide.uniqueblah", 0, false )		-- Collide 'off' for this player
     setElementData( thePlayer, "overrideCollide.uniqueblah", nil, false )		-- Collide 'default' for this player
     setElementData( thePlayer, "overrideAlpha.uniqueblah", 120, false )		-- Alpha '120 maximum' for this player
     setElementData( thePlayer, "overrideAlpha.uniqueblah", nil, false )		-- Alpha 'default' for this player
</syntaxhighlight>
Set 'uniqueblah' to whatever you like (up to 15 characters long)

==Exported Server functions==

{| class="wikitable" border="0"
|-	
|width="80pt"|<syntaxhighlight lang="lua">int</syntaxhighlight>
|width="110pt"|'''getTimePassed'''
|height="38pt"|
|-	
|}

{| class="wikitable" border="0"
|-	
|width="80pt"|<syntaxhighlight lang="lua">int</syntaxhighlight>
|width="110pt"|'''getPlayerRank'''
|<syntaxhighlight lang="lua">player thePlayer</syntaxhighlight>
|-	
|}

{| class="wikitable" border="0"
|-	
|width="80pt"|<syntaxhighlight lang="lua">boolean</syntaxhighlight>
|width="110pt"|'''isPlayerFinished'''
|<syntaxhighlight lang="lua">player thePlayer</syntaxhighlight>
|-	
|}

{| class="wikitable" border="0"
|-	
|width="80pt"|<syntaxhighlight lang="lua">vehicle</syntaxhighlight>
|width="110pt"|'''getPlayerVehicle'''
|<syntaxhighlight lang="lua">player thePlayer</syntaxhighlight>
|-	
|}

[[/ru:Resource:Race.md|ru:Resource:Race]]