== '''Chatcommands - Ccmd''' ==
--[[/User:Jason_Gregory.md|Jason Gregory]] 13:48, 22 March 2010 (UTC)


'''Needs to be tested'''
- For at most 2 arguments <tablename> <target>
(Yeah i think there is no need for more than 2 Arguments, most of the Commands only requires 1-2)
----
'''Ccmd Table'''
Syntax Chatcommandname, CommandHandler
<syntaxhighlight lang="lua">c_cmds = {
 "kick", "k_player",
 "ban", "b_player"
 }</syntaxhighlight>

'''Chatchecker'''
 <syntaxhighlight lang="lua">function c_CommandHandler( message, messageType )
	local arg2
	if(message == 0)then
		nBeginn["c_Start"], nEnd["c_End"] = string.find(message, "!")
		if(nBeginn["c_Start"] ~= false and nBeginn["c_Start"] == 1)then
			message = string.lower(message) -- for accepting chatcommands like /KIcK or /kICK
			if(string.len(string.sub(message, 2)) > 0)then
				l_pos = 1
				for key, c_cmd in pairs(c_cmds), 2 do
					nBeginn["c_Arg"] = string.sub(message, 2, #c_cmds[l_pos]+2)
					-- Word Symbols
					arg2 = #c_cmd[l_pos]+3 -- +1 next arg tab
					l_pos=l_pos+2
					if(nBeginn["c_Arg"] == c_cmd)then
						--c_cmd[l_pos+1]
						l_pos=l_pos-1
						local c_Playa = getElementsByType( "player" )
						for theKey, c_Target in ipairs(c_Playa) do
							nBeginn["c_Target"], nEnd["c_Target"] = string.find(message, c_Target)
							if(nBeginn["c_Target"] == arg2 and nEnd["c_Target"] == #getPlayerName(c_Target)+arg2)then
								if(c_Target ~= source)then
									executeCommandHandler ( c_cmds[l_pos], source, c_Target )
								else
									return outputChatBox("* You are targeting yourself, Retard!", source)
								end
							else
								return outputChatBox("* Player "..string.sub(message,arg2).." not found!", source)
							end
						break -- playerloop
						end
					break -- arg1 loop
					else
						return outputChatBox("* Command !"..nBeginn["c_Arg"].." not found in tha Resource :o", source)
					end
				end
			end
		end
	end
 end
 addEventHandler( "onPlayerChat", getRootElement(), c_CommandHandler)</syntaxhighlight>

'''Called Handler'''
<syntaxhighlight lang="lua">function kickPlayerHandler ( sourcePlayer, commandname, kickedname )
	local kicked = getPlayerFromNick ( kickedname )
	if ( hasObjectPermissionTo ( sourcePlayer, "function.kickPlayer" ) ) then
		kickPlayer ( kicked, sourcePlayer )
	end
end
addCommandHandler ( "k_player", kickPlayerHandler )
 
 function banPlayerCommand ( sourcePlayer, commandName, bannedName )
	if ( hasObjectPermissionTo ( sourcePlayer, "function.banPlayer" ) ) then
		local bannedPlayer = getPlayerFromNick ( bannedName )
		banPlayer ( bannedPlayer, sourcePlayer )
		outputChatBox ( "ban: " .. bannedName .. " successfully banned", sourcePlayer )
	else
		outputChatBox ( "ban: You don't have enough permissions", sourcePlayer )
	end
 
end
addCommandHandler ( "b_player", banPlayerCommand )<code>